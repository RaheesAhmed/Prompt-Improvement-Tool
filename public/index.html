<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prompt Improvement</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <style>
      body {
        background-color: #dee2e6;
        font-family: "Arial", sans-serif;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      }
      #result .card {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <p
        class="mb-4 text-center"
        style="font-family: monospace; font-weight: bold"
      >
        <i class="fas fa-atom me-2 p-2"></i>
        Prompt Improvement Tool
        <i class="fas fa-atom me-2 p-2"></i>
      </p>
      <p class="mb-4 text-center" style="font-size: 14px">
        This tool helps you improve your prompt by generating multiple versions
        of it. You can then select the best version and use it in your GPT-3
        application.
      </p>
      <form id="promptForm">
        <div class="mb-3">
          <!-- <label for="promptInput" class="form-label">Enter your prompt:</label> -->
          <textarea
            class="form-control"
            id="promptInput"
            rows="3"
            placeholder="Type your prompt here..."
            required
            onchange="handlePromptChange()"
          ></textarea>
        </div>
        <div class="d-grid">
          <button
            type="submit"
            class="btn btn-primary btn-lg"
            style="background: black"
          >
            <span
              id="spinner"
              class="spinner-border spinner-border-sm me-2"
              role="status"
              aria-hidden="true"
              style="display: none"
            ></span>

            Improve Prompt
            <i class="fas fa-magic me-2 p-2"></i>
          </button>
        </div>
      </form>
      <div id="result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Function to handle prompt change
      function handlePromptChange() {
        const promptInput = document.getElementById("promptInput");
        const promptText = promptInput.value;
        const variableRegex = /{{(.*?)}}/g;
        const matches = promptText.match(variableRegex);

        if (matches) {
          for (const match of matches) {
            const variableName = match.slice(2, -2);
            const variableType = prompt(
              `Select variable type for "${variableName}"`
            );
            const highlightedVariable = `<span style="background-color: yellow">${variableName} (${variableType})</span>`;
            promptText = promptText.replace(match, highlightedVariable);
          }
        }

        promptInput.value = promptText;
      }

      // Function to handle copying text to clipboard
      function copyToClipboard(button) {
        const text = button.getAttribute("data-text");
        navigator.clipboard
          .writeText(text)
          .then(() => {
            alert("Text copied to clipboard");
          })
          .catch((err) => {
            console.error("Error in copying text: ", err);
          });
      }

      // Event listener for form submission
      document
        .getElementById("promptForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const promptText = document.getElementById("promptInput").value;
          const spinner = document.getElementById("spinner");
          const resultDiv = document.getElementById("result");
          const submitButton = e.target.querySelector('button[type="submit"]');

          spinner.style.display = "inline-block"; // Show spinner
          submitButton.innerHTML = `<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Improving prompts Please wait...`;

          fetch("/improve-prompt", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ originalPrompt: promptText, version: 1 }),
          })
            .then((response) => response.json())
            .then((data) => {
              const improvedPrompts = data.improvedPrompts;
              let resultHtml =
                '<div class="card mb-3"><div class="card-body"><h5 class="card-title">Original Prompt</h5><p class="card-text">' +
                data.originalPrompt +
                "</p></div></div>";

              improvedPrompts.forEach((prompt, index) => {
                resultHtml += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title" display:inline-block;padding: 5px;font-family: math;">Version ${
                                  index + 1
                                }
                                    <button class="btn" onclick='copyToClipboard(this)' data-text="${prompt}">
                                        <i class="far fa-copy"></i>
                                    </button>
                                </h5>
                                <hr>
                                <p class="card-text">${prompt}</p>
                            </div>
                        </div>`;
              });
              resultDiv.innerHTML = resultHtml;
            })
            .catch((error) => {
              console.error("Error:", error);
              resultDiv.innerHTML =
                '<p class="text-danger">An error occurred while improving the prompt.</p>';
            })
            .finally(() => {
              spinner.style.display = "none"; // Hide spinner
              submitButton.innerHTML = "Improve Prompt";
            });
        });
    </script>
  </body>
</html>
